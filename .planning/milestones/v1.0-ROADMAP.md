# Milestone v1.0: MVP

**Status:** SHIPPED 2026-02-05
**Phases:** 1-8
**Total Plans:** 30

## Overview

FlowScript v1.0 builds a text-native workflow engine that executes .flow.md files as programs. The roadmap follows a foundation-first approach: parse files, validate structure, evaluate expressions, then progressively add runtimes (HTTP, File, AI), control flow, parallel execution, and production features. Each phase delivers independently testable capability, culminating in a complete CLI that can run AI-powered workflows from markdown files.

## Phases

### Phase 1: Foundation

**Goal**: Users can validate .flow.md files and receive clear error messages
**Depends on**: Nothing (first phase)
**Requirements**: PARSE-01, PARSE-02, PARSE-03, PARSE-04, PARSE-05, PARSE-06, VALID-01, VALID-02, VALID-04, VALID-05, VALID-06, CLI-01, CLI-04
**Success Criteria** (what must be TRUE):
  1. User can run `flowscript validate example.flow.md` and get pass/fail result
  2. Parser extracts YAML frontmatter (name, version, config, secrets, schemas) correctly
  3. Parser extracts XML body into node AST with source locations preserved
  4. Malformed YAML/XML produces clear error messages with line numbers
  5. Validator catches missing required fields, undefined node references, undeclared secrets, duplicate IDs, and circular dependencies
**Plans**: 5 plans (3 core + 2 gap closure)

Plans:
- [x] 01-01-PLAN.md — Project setup, dependencies, and AST type definitions
- [x] 01-02-PLAN.md — Parser implementation (YAML frontmatter, XML body, source locations)
- [x] 01-03-PLAN.md — Validator and CLI validate command with error formatting
- [x] 01-04-PLAN.md — [GAP CLOSURE] Fix secret reference validation
- [x] 01-05-PLAN.md — [GAP CLOSURE] Add semver validation to version field

**Completed:** 2026-02-02

### Phase 2: Expression & Execution Core

**Goal**: Users can see expressions evaluated and basic sequential execution work
**Depends on**: Phase 1
**Requirements**: EXPR-01, EXPR-02, EXPR-03, EXPR-04, EXPR-05, STATE-03, STATE-04
**Success Criteria** (what must be TRUE):
  1. Expressions like `{{node.output.field}}` resolve to actual node output values
  2. Variable references `$config.key`, `$secrets.NAME`, `$context.key` resolve correctly
  3. Built-in functions (string, array, math, time) work in expressions
  4. Expression errors show context (which expression, what failed)
  5. Context hierarchy (global to phase to node) is maintained during execution
**Plans**: 3 plans (2 waves)

Plans:
- [x] 02-01-PLAN.md — Expression parser and sandboxed evaluator (jsep + AST walker)
- [x] 02-02-PLAN.md — Built-in functions library (string, array, math, time, object, type)
- [x] 02-03-PLAN.md — Context hierarchy and node output tracking integration

**Completed:** 2026-02-02

### Phase 3: Source/Sink Runtimes

**Goal**: Users can execute workflows that fetch HTTP data and read/write files
**Depends on**: Phase 2
**Requirements**: HTTP-01, HTTP-02, HTTP-03, HTTP-04, HTTP-05, FILE-01, FILE-02, FILE-03, FILE-04, FILE-05
**Success Criteria** (what must be TRUE):
  1. HTTP source makes GET requests with headers, params, and bearer auth
  2. HTTP source makes POST requests with JSON body
  3. HTTP sink posts data to external endpoints
  4. HTTP nodes extract response data via JMESPath
  5. File source reads JSON and text files
  6. File sink writes JSON and text files
  7. File paths support template expressions like `{{config.outputDir}}/result.json`
**Plans**: 3 plans (2 waves)

Plans:
- [x] 03-01-PLAN.md — Runtime infrastructure (NodeRuntime interface, error classes, registry)
- [x] 03-02-PLAN.md — HTTP source and sink runtimes (GET/POST, auth, JMESPath extraction)
- [x] 03-03-PLAN.md — File source and sink runtimes (JSON/text, template paths, security)

**Completed:** 2026-02-02

### Phase 4: AI Integration

**Goal**: Users can call AI models with structured output validation
**Depends on**: Phase 3
**Requirements**: AI-01, AI-02, AI-03, AI-04, AI-05, AI-06, AI-07, VALID-03
**Success Criteria** (what must be TRUE):
  1. AI node calls OpenRouter API with model selection (claude-3.5-sonnet, gpt-4, etc.)
  2. AI node supports system prompt and user prompt with template variables
  3. AI output is validated against declared zod schema
  4. AI node retries automatically when schema validation fails
  5. AI node handles rate limits with exponential backoff
  6. AI node respects token budget configuration
  7. Validator checks input/output type compatibility between connected nodes
**Plans**: 4 plans (2 waves)

Plans:
- [x] 04-01-PLAN.md — AI infrastructure (types, errors, retry with exponential backoff)
- [x] 04-02-PLAN.md — Schema DSL parser (TypeScript-like syntax to zod schemas)
- [x] 04-03-PLAN.md — AI runtime (OpenRouter client, template prompts, validation retry)
- [x] 04-04-PLAN.md — Type compatibility validator (AI output schema vs consumer expectations)

**Completed:** 2026-02-05

### Phase 5: Transform & Control Flow

**Goal**: Users can transform data and control workflow execution with branches and loops
**Depends on**: Phase 4
**Requirements**: TRANS-01, TRANS-02, TRANS-03, CTRL-01, CTRL-02, CTRL-03, CTRL-04, CTRL-05, CTRL-06, CTRL-07
**Success Criteria** (what must be TRUE):
  1. Template node renders strings with Handlebars-like syntax
  2. Map node transforms each item in array using expression
  3. Filter node filters array items based on condition
  4. Branch node routes based on pattern matching conditions
  5. If/else node provides simple conditional routing
  6. Loop/while nodes iterate with max count and break conditions
  7. Foreach node iterates over collection items
  8. Break statement exits current loop early
  9. Goto statement jumps to named node
**Plans**: 4 plans (3 waves)

Plans:
- [x] 05-01-PLAN.md — Control flow signals and type definitions (BreakSignal, GotoSignal, configs)
- [x] 05-02-PLAN.md — Transform runtimes (template, map, filter)
- [x] 05-03-PLAN.md — Control flow runtimes (branch, if, loop, while, foreach, break, goto)
- [x] 05-04-PLAN.md — Registry integration and tests

**Completed:** 2026-02-05

### Phase 6: Scheduling & Parallelism

**Goal**: Users can run independent nodes in parallel for faster execution
**Depends on**: Phase 5
**Requirements**: PARA-01, PARA-02, PARA-03, PARA-04, PARA-05
**Success Criteria** (what must be TRUE):
  1. Scheduler builds DAG from node dependencies
  2. Scheduler calculates execution waves (nodes that can run in parallel)
  3. Executor runs wave nodes concurrently up to concurrency limit
  4. Parallel block runs child branches simultaneously
  5. Foreach supports max-concurrency attribute to limit parallel iterations
**Plans**: 4 plans (4 waves)

Plans:
- [x] 06-01-PLAN.md — Scheduler types, Semaphore, DAG building, and wave computation
- [x] 06-02-PLAN.md — Executor with wave processing and concurrency control
- [x] 06-03-PLAN.md — Parallel runtime and executor integration
- [x] 06-04-PLAN.md — Foreach parallel iteration and integration tests

**Completed:** 2026-02-05

### Phase 7: Production Readiness

**Goal**: Users can rely on workflows recovering from failures and resuming from checkpoints
**Depends on**: Phase 6
**Requirements**: ERR-01, ERR-02, ERR-03, ERR-04, ERR-05, STATE-01, STATE-02, CHKPT-01, CHKPT-02, CHKPT-03, CHKPT-04, LOG-01, LOG-02, LOG-03, LOG-04
**Success Criteria** (what must be TRUE):
  1. Nodes retry with exponential backoff and jitter on failure
  2. Nodes can fallback to alternative node when primary fails
  3. Nodes respect configurable timeout
  4. Workflow-level error handler captures unhandled failures
  5. Execution state persists to JSON file after each wave
  6. Failed workflow can resume from last checkpoint
  7. Checkpoint node pauses execution and prompts user for approval/input
  8. Execution log is appended to markdown footer with run ID, timing, and per-node status
**Plans**: 5 plans (3 waves)

Plans:
- [x] 07-01-PLAN.md — Retry/timeout infrastructure and state persistence functions
- [x] 07-02-PLAN.md — Checkpoint runtime for human-in-the-loop workflow pauses
- [x] 07-03-PLAN.md — Executor integration: retry, fallback, error handler, persistence
- [x] 07-04-PLAN.md — Workflow resume and execution logging
- [x] 07-05-PLAN.md — Final integration and comprehensive testing

**Completed:** 2026-02-05

### Phase 8: Full CLI

**Goal**: Users have complete CLI experience with all run options
**Depends on**: Phase 7
**Requirements**: CLI-02, CLI-03, CLI-05, CLI-06
**Success Criteria** (what must be TRUE):
  1. `flowscript run <file>` executes workflow and shows progress
  2. `flowscript run --dry-run` validates and shows execution plan without running
  3. `--config key=value` overrides frontmatter config values
  4. `--input '{"field": "value"}'` provides workflow input data
**Plans**: 2 plans (2 waves)

Plans:
- [x] 08-01-PLAN.md — Run command implementation with all options (dry-run, config, input)
- [x] 08-02-PLAN.md — Comprehensive tests for run command

**Completed:** 2026-02-05

---

## Milestone Summary

**Key Decisions:**

- Bun over Node for faster startup and native TypeScript
- OpenRouter for AI — model-agnostic single API
- File-based state persistence for simplicity
- XML for execution logic — self-documenting and PR-readable
- Wave-based parallelism with DAG scheduling
- jsep for expression parsing with bitwise ops removed
- Luxon for date/time operations
- Tool calling for AI structured output
- Semaphore-based concurrency control

**Issues Resolved:**

- XXE injection prevention (processEntities: false)
- YAML deserialization safety (Bun.YAML)
- Secret reference validation (scan raw source)
- Path traversal security (reject ../ and absolute paths)
- Prototype pollution prevention (BLOCKED_PROPS Set)

**Technical Debt Incurred:**

None — all phases completed without anti-patterns.

---

_For current project status, see .planning/ROADMAP.md (next milestone)_
_Archived: 2026-02-05 as part of v1.0 milestone completion_
